<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ko" lang="ko">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>NeuralNetDiffEq.jl: A Neural Network solver for ODEs</title>
  <meta name="author" content="Jeff Bezanson, Stefan Karpinski, Viral Shah, Alan Edelman, et al." />
  <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
  <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="/css/custom.css" type="text/css" media="screen, projection" />

  <!-- 단어 단위 줄바꿈  -->
  <script type="text/javascript" src="/js/jquery-1.8.3.min.js"></script>
  <script type="text/javascript" src="/js/jquery.word-break-keep-all.min.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $('p').wordBreakKeepAll();
    });
  </script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110655381-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-110655381-1'); // juliakorea 추적 ID
  </script>
</head>

<body>
  <div id="site" class="site">
    
    <div class="title"><a href="/">
<svg version="1.1" id="Layer_1"
	 xmlns="http://www.w3.org/2000/svg"
	 xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="210px" height="142px" viewBox="0 0 310 216" enable-background="new 0 0 310 216"
	 xml:space="preserve">

<!-- blue dot -->
<circle fill="#6b85dd" stroke="#4266d5" stroke-width="3" cx="50.5" cy="60" r="16.5"/>
<!-- red dot -->
<circle fill="#d66661" stroke="#c93d39" stroke-width="3" cx="212.459" cy="60" r="16.5"/>
<!-- green dot -->
<circle fill="#6bab5b" stroke="#3b972e" stroke-width="3" cx="233.834" cy="23.874" r="16.5"/>
<!-- purple dot -->
<circle fill="#aa7dc0" stroke="#945bb0" stroke-width="3" cx="255.209" cy="60" r="16.5"/>

<!-- "j" -->
<path fill="#252525" d="M37.216,138.427c0-15.839,0.006-31.679-0.018-47.517c-0.001-0.827,0.169-1.234,1.043-1.47
	c7.876-2.127,15.739-4.308,23.606-6.47c1.33-0.366,1.333-0.36,1.333,1.019c0,25.758,0.015,51.517-0.012,77.274
	c-0.006,5.514,0.245,11.032-0.272,16.543c-0.628,6.69-2.15,13.092-6.438,18.506c-3.781,4.771-8.898,7.25-14.767,8.338
	c-6.599,1.222-13.251,1.552-19.934,0.938c-4.616-0.423-9.045-1.486-12.844-4.363c-2.863-2.168-4.454-4.935-3.745-8.603
	c0.736-3.806,3.348-5.978,6.861-7.127c2.262-0.74,4.628-0.872,6.994-0.53c1.823,0.264,3.42,1.023,4.779,2.288
	c1.38,1.284,2.641,2.674,3.778,4.177c0.872,1.15,1.793,2.256,2.991,3.086c2.055,1.426,4,0.965,5.213-1.216
	c0.819-1.473,0.997-3.106,1.173-4.731c0.255-2.348,0.255-4.707,0.256-7.062C37.218,167.145,37.216,152.786,37.216,138.427z"/>

<!-- "u" -->
<path fill="#252525" d="M125.536,162.479c-2.908,2.385-5.783,4.312-8.88,5.904c-10.348,5.323-20.514,4.521-30.324-1.253
	c-6.71-3.95-11.012-9.849-12.52-17.606c-0.236-1.213-0.363-2.438-0.363-3.688c0.01-19.797,0.017-39.593-0.02-59.39
	c-0.002-1.102,0.285-1.357,1.363-1.351c7.798,0.049,15.597,0.044,23.396,0.003c0.95-0.005,1.177,0.25,1.175,1.183
	c-0.027,19.356-0.025,38.713-0.018,58.07c0.002,6.34,3.599,10.934,9.672,12.42c2.13,0.521,4.19,0.396,6.173-0.6
	c4.26-2.139,7.457-5.427,10.116-9.307c0.333-0.487,0.224-1,0.224-1.51c0.007-19.635,0.016-39.271-0.02-58.904
	c-0.002-1.083,0.255-1.369,1.353-1.361c7.838,0.052,15.677,0.045,23.515,0.004c0.916-0.005,1.103,0.244,1.102,1.124
	c-0.025,27.677-0.026,55.353,0.002,83.024c0.001,0.938-0.278,1.099-1.139,1.095c-7.918-0.028-15.837-0.028-23.756-0.001
	c-0.815,0.003-1.1-0.166-1.073-1.037C125.581,167.117,125.536,164.928,125.536,162.479z"/>

<!-- "l" -->
<path fill="#252525" d="M187.423,107.08c0,20.637-0.011,41.273,0.026,61.91c0.003,1.119-0.309,1.361-1.381,1.355
	c-7.799-0.052-15.598-0.047-23.396-0.008c-0.898,0.008-1.117-0.222-1.115-1.115c0.021-39.074,0.021-78.147,0-117.226
	c0-0.811,0.189-1.169,1.006-1.392c7.871-2.149,15.73-4.327,23.584-6.545c1.045-0.295,1.308-0.17,1.306,0.985
	C187.412,65.727,187.423,86.403,187.423,107.08z"/>

<!-- "i" -->
<path fill="#252525" d="M223.46,126.477c0,14.155-0.011,28.312,0.021,42.467c0.002,1.027-0.164,1.418-1.332,1.408
	c-7.838-0.061-15.676-0.047-23.516-0.01c-0.881,0.004-1.121-0.189-1.119-1.104c0.026-26.153,0.025-52.307,0-78.458
	c0-0.776,0.203-1.101,0.941-1.302c7.984-2.172,15.972-4.35,23.938-6.596c1.049-0.296,1.08,0.031,1.078,0.886
	C223.454,98.004,223.46,112.239,223.46,126.477z"/>

<!-- "a" -->
<path fill="#252525" d="M277.695,163.6c-0.786,0.646-1.404,1.125-2,1.635c-4.375,3.746-9.42,5.898-15.16,6.42
	c-5.792,0.527-11.479,0.244-16.934-2.047c-12.08-5.071-15.554-17.188-11.938-27.448c1.799-5.111,5.472-8.868,9.831-11.94
	c5.681-4.003,12.009-6.732,18.504-9.074c5.576-2.014,11.186-3.939,16.955-5.347c0.445-0.104,0.773-0.243,0.757-0.854
	c-0.136-4.389,0.261-8.79-0.479-13.165c-1.225-7.209-6.617-10.013-12.895-9.348c-0.516,0.055-1.029,0.129-1.536,0.241
	c-4.877,1.081-7.312,4.413-7.374,10.127c-0.02,1.729-0.229,3.418-0.693,5.084c-0.906,3.229-2.969,5.354-6.168,6.266
	c-3.422,0.979-6.893,0.998-10.23-0.305c-6.529-2.543-8.877-10.164-5.12-16.512c2.249-3.799,5.606-6.4,9.461-8.405
	c6.238-3.246,12.914-4.974,19.896-5.537c7.565-0.61,15.096-0.366,22.49,1.507c4.285,1.085,8.312,2.776,11.744,5.657
	c4.473,3.749,6.776,8.647,6.812,14.374c0.139,21.477,0.096,42.951,0.143,64.428c0.002,0.799-0.248,0.983-1.021,0.98
	c-8.035-0.025-16.074-0.023-24.113-0.001c-0.716,0.002-0.973-0.146-0.941-0.915C277.736,167.562,277.695,165.698,277.695,163.6z
	 M277.695,126.393c-4.793,2.104-9.25,4.373-13.287,7.408c-2.151,1.618-4.033,3.483-5.732,5.581
	c-4.229,5.226-1.988,13.343,1.693,16.599c1.592,1.406,3.359,1.906,5.419,1.521c1.621-0.307,3.149-0.857,4.549-1.734
	c1.521-0.951,2.949-2.072,4.539-2.887c2.31-1.18,2.97-2.861,2.894-5.445C277.561,140.484,277.695,133.527,277.695,126.393z"/>

</svg>

</a></div>

<ul class="links">
  
      
      
      
      
      
      <li><a href="/" class=" ">홈</a></li>
  
      
      
      
      
      
      <li><a href="https://github.com/JuliaLang/julia" class=" ">소스코드</a></li>
  
      
      
      
      
      
      <li><a href="/downloads/" class=" ">다운로드</a></li>
  
      
      
      
      
      
      <li><a href="/ko/latest/" class=" docs">문서</a></li>
  
      
      
      
      
      
      <li><a href="http://pkg.julialang.org/" class=" ">패키지</a></li>
  
      
      
      
      
      
      <li><a href="/blog/" class="active ">블로그</a></li>
  
      
      
      
      
      
      <li><a href="/community/" class=" ">커뮤니티</a></li>
  
      
      
      
      
      
      <li><a href="/ecosystems" class=" ">생태계</a></li>
  
      
      
      
      
      
      <li><a href="/learning/" class=" ">배우기</a></li>
  
      
      
      
      
      
      <li><a href="/teaching/" class=" ">강의</a></li>
  
      
      
      
      
      
      <li><a href="/publications/" class=" ">논문</a></li>
  
      
      
      
      
      
      <li><a href="/soc/ideas-page.html" class=" ">GSoC</a></li>
  
      
      
      
      
      
      <li><a href="http://juliacon.org" class=" ">줄리아컨퍼런스</a></li>
  
</ul>

<!--

<style>
.banner-box .header {
  font-size: 1.5em;
}
@media (min-width: 830px) {
  .banner-box {
    float:left;
    width:50%;
  }
}
</style>

<div style="text-align:center">

<div class="banner-box">
<div class="header">JuliaCon 2016</div>
<p>
  Held on June 21<sup>st</sup> - 25<sup>th</sup> at MIT<br>
  <a href="http://juliacon.org">talks</a> |
  <a href="https://www.youtube.com/playlist?list=PLP8iPy9hna6SQPwZUDtAM59-wPzCPyD_S">videos</a>
</p>
</div>

<div class="banner-box">
<div class="header">Google Summer of Code</div>
<p>
  Julia gets 12 slots in the Google Summer of Code!<br />
  <a href="https://summerofcode.withgoogle.com/organizations/6453977159827456/">projects</a> |
  <a href="/soc/ideas-page.html">ideas list</a>
</p>
</div>

<div style="clear:both; border-top: 1px solid #ddd; margin-bottom:30px;"></div>


</div>
-->


<div id="blogpost">
  <h1>NeuralNetDiffEq.jl: A Neural Network solver for ODEs</h1>

  <p class="metadata">
    <span class="timestamp">13 Oct 2017</span>
    
    &nbsp;|&nbsp;
    <span class="author">Akshay Sharma</span>
    
  </p>

  <p>My GSoC 2017 <a href="https://summerofcode.withgoogle.com/projects/#5850956641075200">project</a> was to implement a package for Julia to solve Ordinary Differential Equations using Neural Networks.
The purpose of the project was to provide an additional DE solver using Neural Networks which has parallelism in time as the key advantage over other solvers which are iterative in nature. The project was based on research paper of <a href="https://arxiv.org/pdf/physics/9705023.pdf">Lagaris et al. 1997</a> which proposed the function approximation capabilities of neural networks (NNs) for solving differential equations. The project was a mixture of research as well as implementation aspects and still has a few parts left to work upon.
I chose to work on this project as I have interest in mathematics and machine learning and it involved concepts of both the fields. The package uses <a href="https://github.com/JuliaDiffEq/DifferentialEquations.jl">DifferentialEquations.jl</a> for the solver interface and <a href="https://github.com/denizyuret/Knet.jl">KNet.jl</a> for NN solver implementation.</p>

<h2 id="how-to-use-neural-network-for-solving-differential-equations">How to use Neural Network for solving Differential Equations?</h2>
<p>The concept of this solver is based on the UAT (Universal Approximation Theorem) which says that a NN with at least one hidden layer can approximate any continuous function. The neural network is made to minimize a loss function, defined as the difference between the NN’s derivative and the derivative of the differential equation, which then results in the convergence of our trial solution towards the actual (analytical) solution of the differential equation. To know more about UAT <a href="http://neuralnetworksanddeeplearning.com/chap4.html">click here</a>.</p>

<h2 id="research-aspect-of-the-project-and-the-challenge">Research aspect of the project and the challenge</h2>
<p>The research paper we referred to on the topic is quite old and understanding the examples as well as explanations was quite challenging. Not much research has been done on using NNs for this purpose and thus we were not able to get much help from the research papers related to the topic.
The initial task was to read and understand the mathematics behind solving differential equations. Also the computational methods used to solve differential equations on computers are quite different from the ones we use on paper so it took quite some time to get familiar with them. The structure and type of NN to be used so that the solver advantages (parallelism in time) are retained without compromising the performance was a research subdomain as well was a challenge.</p>

<p>After implementing the solver for ODEs (Ordinary Differential Equations) and systems of ODEs, the difficult part was to make the NN converge for the systems of ODEs on longer time domains.
As there are a lot of factors involved in neural networks, like hidden layer width, number of hidden neurons, activations, weights etc., I relied on my machine learning background as well as the help from my mentors to experiment with most of the feasible settings of NN hyper-parameters and recording the accuracy of convergence and performance of the solver.
Making the NNs converge for systems of ODEs is not as easy as it seems and took up most of the time for experimentation and tuning. Predicting the system of DEs solution with larger domain is still a challenge which needs to be worked upon.</p>

<h2 id="implementation-and-work">Implementation and Work</h2>
<p>The implementation involved integration of mathematical and machine learning aspects to build a neural net solver for ODEs. The <a href="https://github.com/JuliaDiffEq/DiffEqBase.jl">DiffEqBase library</a> is used as a base to extend the algorithm and solver interface while the neural network was developed using the <a href="https://github.com/denizyuret/Knet.jl">Knet.jl library</a>. The work done till now can be seen on the <a href="https://github.com/JuliaDiffEq/NeuralNetDiffEq.jl">NeuralNetDiffEq.jl github repository</a>, primarily in <a href="https://github.com/JuliaDiffEq/NeuralNetDiffEq.jl/tree/SingleNN_Approach">this branch</a>.
This work involves implementing a Neural Network solver for ODEs with customized interpolation based on NN prediction.</p>

<h3 id="how-does-it-work">How does it work?</h3>
<p>We construct a trial solution for our differential equation in terms of the NN output which should also satisfy the DE boundary conditions. We define a loss function for the neural net which is the difference between the derivative of the neural net solution with regards to its input and the true derivative defined by the ODE. This is an unusual loss function, in that in includes the gradient of the network itself. It is almost unseen elsewhere in other ML applications This loss function is minimized (by equating the derivative difference to zero) using the NN (closer to 0 better convergence) with the trial solution substituted in it in place of the original function (or the solution to the DE). The neural network tunes its weights using the Adam optimization algorithm on the backpropagated gradients from that loss function.</p>

<p>For parallel implementation in time we use KnetArray (the array type used in <a href="https://github.com/denizyuret/Knet.jl">KNet.jl</a>) which uses CPU by default but GPU usage is also supported for parallelism but requires CUDNN driver installed to access GPU hardware.</p>

<h2 id="examples">Examples</h2>
<p>Below you can find a few examples on how to use the package I’ve been working on.
Following are the initial imports required for the package to work.</p>
<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">using</span> <span class="n">NeuralNetDiffEq</span>
<span class="n">using</span> <span class="n">Plots</span><span class="x">;</span> <span class="n">plotly</span><span class="x">()</span>
<span class="n">using</span> <span class="n">DiffEqBase</span><span class="x">,</span> <span class="n">ParameterizedFunctions</span>
<span class="n">using</span> <span class="n">DiffEqProblemLibrary</span><span class="x">,</span> <span class="n">DiffEqDevTools</span>
<span class="n">using</span> <span class="n">Knet</span>
</code></pre></div></div>
<h3 id="ode-examples">ODE Examples</h3>
<h4 id="example-1">Example 1</h4>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">linear</span> <span class="o">=</span> <span class="x">(</span><span class="n">t</span><span class="x">,</span><span class="n">u</span><span class="x">)</span> <span class="o">-&gt;</span> <span class="x">(</span><span class="mf">1.01</span><span class="o">*</span><span class="n">u</span><span class="x">)</span>
  <span class="x">(</span><span class="n">f</span><span class="o">::</span><span class="nb">typeof</span><span class="x">(</span><span class="n">linear</span><span class="x">))(</span><span class="o">::</span><span class="n">Type</span><span class="x">{</span><span class="n">Val</span><span class="x">{:</span><span class="n">analytic</span><span class="x">}},</span><span class="n">t</span><span class="x">,</span><span class="n">u0</span><span class="x">)</span> <span class="o">=</span> <span class="n">u0</span><span class="o">*</span><span class="n">exp</span><span class="x">(</span><span class="mf">1.01</span><span class="o">*</span><span class="n">t</span><span class="x">)</span>
  <span class="n">prob</span> <span class="o">=</span> <span class="n">ODEProblem</span><span class="x">(</span><span class="n">linear</span><span class="x">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="x">,(</span><span class="mf">0.0</span><span class="x">,</span><span class="mf">1.0</span><span class="x">))</span>
  <span class="n">sol</span> <span class="o">=</span> <span class="n">solve</span><span class="x">(</span><span class="n">prob</span><span class="x">,</span><span class="n">nnode</span><span class="x">(</span><span class="mi">10</span><span class="x">),</span><span class="n">dt</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">10</span><span class="x">,</span><span class="n">iterations</span><span class="o">=</span><span class="mi">10</span><span class="x">)</span>
  <span class="n">plot</span><span class="x">(</span><span class="n">sol</span><span class="x">,</span><span class="n">plot_analytic</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>
</code></pre></div></div>
<p><img src="/images/blog/2017-09-04-gsoc-NeuralNetDiffEq/plot_ode1.png" alt="Plot_ode1" title="Plot 1" /></p>
<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">sol</span><span class="x">(</span><span class="mf">0.232</span><span class="x">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  1-element Array{Any,1}:
   0.625818 #### Example 2
</code></pre></div></div>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f</span> <span class="o">=</span> <span class="x">(</span><span class="n">t</span><span class="x">,</span><span class="n">u</span><span class="x">)</span> <span class="o">-&gt;</span> <span class="x">(</span><span class="n">t</span><span class="o">^</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="x">(</span><span class="n">t</span><span class="o">^</span><span class="mi">2</span><span class="x">)</span><span class="o">*</span><span class="x">((</span><span class="mi">1</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="x">(</span><span class="n">t</span><span class="o">^</span><span class="mi">2</span><span class="x">))</span><span class="o">/</span><span class="x">(</span><span class="mi">1</span><span class="o">+</span><span class="n">t</span><span class="o">+</span><span class="x">(</span><span class="n">t</span><span class="o">^</span><span class="mi">3</span><span class="x">)))</span> <span class="o">-</span> <span class="n">u</span><span class="o">*</span><span class="x">(</span><span class="n">t</span> <span class="o">+</span> <span class="x">((</span><span class="mi">1</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="x">(</span><span class="n">t</span><span class="o">^</span><span class="mi">2</span><span class="x">))</span><span class="o">/</span><span class="x">(</span><span class="mi">1</span><span class="o">+</span><span class="n">t</span><span class="o">+</span><span class="n">t</span><span class="o">^</span><span class="mi">3</span><span class="x">))))</span>
<span class="x">(</span><span class="o">::</span><span class="nb">typeof</span><span class="x">(</span><span class="n">f</span><span class="x">))(</span><span class="o">::</span><span class="n">Type</span><span class="x">{</span><span class="n">Val</span><span class="x">{:</span><span class="n">analytic</span><span class="x">}},</span><span class="n">t</span><span class="x">,</span><span class="n">u0</span><span class="x">)</span> <span class="o">=</span>  <span class="n">u0</span><span class="o">*</span><span class="n">exp</span><span class="x">(</span><span class="o">-</span><span class="x">(</span><span class="n">t</span><span class="o">^</span><span class="mi">2</span><span class="x">)</span><span class="o">/</span><span class="mi">2</span><span class="x">)</span><span class="o">/</span><span class="x">(</span><span class="mi">1</span><span class="o">+</span><span class="n">t</span><span class="o">+</span><span class="n">t</span><span class="o">^</span><span class="mi">3</span><span class="x">)</span> <span class="o">+</span> <span class="n">t</span><span class="o">^</span><span class="mi">2</span>
<span class="n">prob2</span> <span class="o">=</span> <span class="n">ODEProblem</span><span class="x">(</span><span class="n">f</span><span class="x">,</span><span class="mf">1.0</span><span class="x">,(</span><span class="mf">0.0</span><span class="x">,</span><span class="mf">1.0</span><span class="x">))</span>
<span class="n">sol2</span> <span class="o">=</span> <span class="n">solve</span><span class="x">(</span><span class="n">prob2</span><span class="x">,</span><span class="n">nnode</span><span class="x">(</span><span class="mi">10</span><span class="x">),</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.1</span><span class="x">,</span><span class="n">iterations</span><span class="o">=</span><span class="mi">200</span><span class="x">)</span>
 <span class="n">plot</span><span class="x">(</span><span class="n">sol</span><span class="x">,</span><span class="n">plot_analytic</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>
</code></pre></div></div>
<p><img src="/images/blog/2017-09-04-gsoc-NeuralNetDiffEq/plot_ode2.png" alt="Plot_ode2" title="Plot 2" /></p>
<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">sol</span><span class="x">(</span><span class="mf">0.47</span><span class="x">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  1-element Array{Any,1}:
   0.803109
</code></pre></div></div>

<h4 id="example-3">Example 3</h4>
<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f2</span> <span class="o">=</span> <span class="x">(</span><span class="n">t</span><span class="x">,</span><span class="n">u</span><span class="x">)</span> <span class="o">-&gt;</span> <span class="x">(</span><span class="o">-</span><span class="n">u</span><span class="o">/</span><span class="mi">5</span> <span class="o">+</span> <span class="n">exp</span><span class="x">(</span><span class="o">-</span><span class="n">t</span><span class="o">/</span><span class="mi">5</span><span class="x">)</span><span class="o">.*</span><span class="n">cos</span><span class="x">(</span><span class="n">t</span><span class="x">))</span>
<span class="x">(</span><span class="o">::</span><span class="nb">typeof</span><span class="x">(</span><span class="n">f2</span><span class="x">))(</span><span class="o">::</span><span class="n">Type</span><span class="x">{</span><span class="n">Val</span><span class="x">{:</span><span class="n">analytic</span><span class="x">}},</span><span class="n">t</span><span class="x">,</span><span class="n">u0</span><span class="x">)</span> <span class="o">=</span>  <span class="n">exp</span><span class="x">(</span><span class="o">-</span><span class="n">t</span><span class="o">/</span><span class="mi">5</span><span class="x">)</span><span class="o">*</span><span class="x">(</span><span class="n">u0</span> <span class="o">+</span> <span class="n">sin</span><span class="x">(</span><span class="n">t</span><span class="x">))</span>
<span class="n">prob3</span> <span class="o">=</span> <span class="n">ODEProblem</span><span class="x">(</span><span class="n">f2</span><span class="x">,</span><span class="kt">Float32</span><span class="x">(</span><span class="mf">0.0</span><span class="x">),(</span><span class="kt">Float32</span><span class="x">(</span><span class="mf">0.0</span><span class="x">),</span><span class="kt">Float32</span><span class="x">(</span><span class="mf">2.0</span><span class="x">)))</span>
<span class="n">sol3</span> <span class="o">=</span> <span class="n">solve</span><span class="x">(</span><span class="n">prob3</span><span class="x">,</span><span class="n">nnode</span><span class="x">(</span><span class="mi">10</span><span class="x">),</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.2</span><span class="x">,</span><span class="n">iterations</span><span class="o">=</span><span class="mi">1000</span><span class="x">)</span>
 <span class="n">plot</span><span class="x">(</span><span class="n">sol</span><span class="x">,</span><span class="n">plot_analytic</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>
</code></pre></div></div>
<p><img src="/images/blog/2017-09-04-gsoc-NeuralNetDiffEq/plot_ode3.png" alt="Plot_ode3" title="Plot 3" /></p>
<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">sol3</span><span class="x">([</span><span class="mf">0.721</span><span class="x">])</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  1-element Array{Any,1}:
    Any[0.574705]
</code></pre></div></div>

<h3 id="system-of-odes-examples">System of ODEs Examples</h3>
<h4 id="example-1--ode-2d-linear">Example 1  ODE 2D Linear</h4>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f_2dlinear</span> <span class="o">=</span> <span class="x">(</span><span class="n">t</span><span class="x">,</span><span class="n">u</span><span class="x">)</span> <span class="o">-&gt;</span> <span class="n">begin</span>
    <span class="n">du</span> <span class="o">=</span> <span class="n">Array</span><span class="x">{</span><span class="kt">Any</span><span class="x">}(</span><span class="n">length</span><span class="x">(</span><span class="n">u</span><span class="x">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="x">:</span><span class="n">length</span><span class="x">(</span><span class="n">u</span><span class="x">)</span>
    <span class="n">du</span><span class="x">[</span><span class="n">i</span><span class="x">]</span> <span class="o">=</span> <span class="mf">1.01</span><span class="o">*</span><span class="n">u</span><span class="x">[</span><span class="n">i</span><span class="x">]</span>
  <span class="k">end</span>
    <span class="k">return</span> <span class="n">du</span>
<span class="k">end</span>
<span class="x">(</span><span class="n">f</span><span class="o">::</span><span class="nb">typeof</span><span class="x">(</span><span class="n">f_2dlinear</span><span class="x">))(</span><span class="o">::</span><span class="n">Type</span><span class="x">{</span><span class="n">Val</span><span class="x">{:</span><span class="n">analytic</span><span class="x">}},</span><span class="n">t</span><span class="x">,</span><span class="n">u0</span><span class="x">)</span> <span class="o">=</span> <span class="n">u0</span><span class="o">*</span><span class="n">exp</span><span class="o">.</span><span class="x">(</span><span class="mf">1.01</span><span class="o">*</span><span class="n">t</span><span class="x">)</span>
<span class="n">prob_ode_2Dlinear</span> <span class="o">=</span> <span class="n">ODEProblem</span><span class="x">(</span><span class="n">f_2dlinear</span><span class="x">,</span><span class="n">rand</span><span class="x">(</span><span class="mi">4</span><span class="x">,</span><span class="mi">1</span><span class="x">),(</span><span class="mf">0.0</span><span class="x">,</span><span class="mf">1.0</span><span class="x">))</span>
<span class="n">sol1</span> <span class="o">=</span> <span class="n">solve</span><span class="x">(</span><span class="n">prob_ode_2Dlinear</span><span class="x">,</span><span class="n">nnode</span><span class="x">([</span><span class="mi">10</span><span class="x">,</span><span class="mi">50</span><span class="x">]),</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.1</span><span class="x">,</span><span class="n">iterations</span><span class="o">=</span><span class="mi">100</span><span class="x">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(:iteration,100,:loss,0.004670103680503722)
 16.494870 seconds (90.08 M allocations: 6.204 GB, 5.82% gc time)
</code></pre></div></div>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="x">(</span><span class="n">sol1</span><span class="x">,</span><span class="n">plot_analytic</span><span class="o">=</span><span class="n">true</span><span class="x">)</span>
</code></pre></div></div>
<p><img src="/images/blog/2017-09-04-gsoc-NeuralNetDiffEq/plot_ode1.png" alt="Plot_sode1" title="Plot 1" /></p>
<h4 id="example-2-lotka-volterra">Example 2 Lotka Volterra</h4>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span><span class="nf"> lotka_volterra</span><span class="x">(</span><span class="n">t</span><span class="x">,</span><span class="n">u</span><span class="x">)</span>
  <span class="n">du1</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">.*</span> <span class="n">u</span><span class="x">[</span><span class="mi">1</span><span class="x">]</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">.*</span> <span class="n">u</span><span class="x">[</span><span class="mi">1</span><span class="x">]</span><span class="o">.*</span><span class="n">u</span><span class="x">[</span><span class="mi">2</span><span class="x">]</span>
  <span class="n">du2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span> <span class="o">.*</span> <span class="n">u</span><span class="x">[</span><span class="mi">2</span><span class="x">]</span> <span class="o">+</span> <span class="n">u</span><span class="x">[</span><span class="mi">1</span><span class="x">]</span><span class="o">.*</span><span class="n">u</span><span class="x">[</span><span class="mi">2</span><span class="x">]</span>
  <span class="x">[</span><span class="n">du1</span><span class="x">,</span><span class="n">du2</span><span class="x">]</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lotka_volterra (generic function with 1 method)
</code></pre></div></div>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">prob_ode_lotkavoltera</span> <span class="o">=</span> <span class="n">ODEProblem</span><span class="x">(</span><span class="n">lotka_volterra</span><span class="x">,</span><span class="kt">Float32</span><span class="x">[</span><span class="mf">1.0</span><span class="x">,</span><span class="mf">1.0</span><span class="x">],(</span><span class="kt">Float32</span><span class="x">(</span><span class="mf">0.0</span><span class="x">),</span><span class="kt">Float32</span><span class="x">(</span><span class="mf">1.0</span><span class="x">)))</span>
<span class="n">sol2</span> <span class="o">=</span> <span class="n">solve</span><span class="x">(</span><span class="n">prob_ode_lotkavoltera</span><span class="x">,</span><span class="n">nnode</span><span class="x">([</span><span class="mi">10</span><span class="x">,</span><span class="mi">50</span><span class="x">]),</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.2</span><span class="x">,</span><span class="n">iterations</span><span class="o">=</span><span class="mi">1000</span><span class="x">)</span>
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(:iteration,100,:loss,0.020173132003438572)
(:iteration,200,:loss,0.005130137452114811)
(:iteration,300,:loss,0.004812458584875589)
(:iteration,400,:loss,0.010083624565714974)
(:iteration,500,:loss,0.0025328170079611887)
(:iteration,600,:loss,0.007685579218433846)
(:iteration,700,:loss,0.005065291031504465)
(:iteration,800,:loss,0.005326863832044214)
(:iteration,900,:loss,0.00030436474139241827)
(:iteration,1000,:loss,0.0034853904995959094)
 22.126081 seconds (99.65 M allocations: 5.923 GB, 5.21% gc time)
</code></pre></div></div>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="x">(</span><span class="n">sol2</span><span class="x">)</span>
</code></pre></div></div>
<p><img src="/images/blog/2017-09-04-gsoc-NeuralNetDiffEq/plot_sode2.png" alt="Plot_sode2" title="Plot 2" /></p>

<p>To show that the solver with current settings and hyper-parameters does not work for a larger domain (Eg 0-10) <code class="highlighter-rouge">lotka_volterra</code> here is a graph:</p>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">prob_ode_lotkavoltera</span> <span class="o">=</span> <span class="n">ODEProblem</span><span class="x">(</span><span class="n">lotka_volterra</span><span class="x">,</span><span class="kt">Float32</span><span class="x">[</span><span class="mf">1.0</span><span class="x">,</span><span class="mf">1.0</span><span class="x">],(</span><span class="kt">Float32</span><span class="x">(</span><span class="mf">0.0</span><span class="x">),</span><span class="kt">Float32</span><span class="x">(</span><span class="mf">5.0</span><span class="x">)))</span>
<span class="n">sol3</span> <span class="o">=</span> <span class="n">solve</span><span class="x">(</span><span class="n">prob_ode_lotkavoltera</span><span class="x">,</span><span class="n">nnode</span><span class="x">([</span><span class="mi">10</span><span class="x">,</span><span class="mi">50</span><span class="x">]),</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.2</span><span class="x">,</span><span class="n">iterations</span><span class="o">=</span><span class="mi">1000</span><span class="x">)</span>
<span class="n">plot</span><span class="x">(</span><span class="n">sol3</span><span class="x">)</span>
</code></pre></div></div>
<p><img src="/images/blog/2017-09-04-gsoc-NeuralNetDiffEq/plot_sode3.png" alt="Plot_sode3" title="Plot 3" /></p>

<p>However, the <a href="http://app.juliadiffeq.org/ode;settings=eyJkaWZmRXFUZXh0IjoiZHggPSBhKnggLSBiKngqeVxuZHkgPSAtYyp5ICsgZCp4KnkiLCJwYXJhbWV0ZXJzIjoiYT0xLjUsIGI9MSwgYz0zLCBkPTEiLCJ0aW1lU3BhbiI6WzAsMTBdLCJpbml0aWFsQ29uZGl0aW9ucyI6IjEuMCwgMS4wIiwic29sdmVyIjoiVHNpdDUiLCJ2YXJzIjoiWzp4LCA6eV0iLCJ0aXRsZSI6IlRoZSBMb3RrYS1Wb2x0ZXJyYSBFcXVhdGlvbnM6IE1vZGVsIG9mIFJhYmJpdHMgYW5kIFdvbHZlcyJ9">true solution should be oscillatory, indicating that the NN did not properly converge</a>.
To see more examples and experiment results you can check out my Jupyter notebooks <a href="http://nbviewer.jupyter.org/gist/akaysh/43c9db281b0bd3224114084c44263c13">here</a>.</p>

<h2 id="future-work">Future Work</h2>
<p>More of research on how to optimize the NN for speed and better convergence is required. For systems of ODEs with larger domains the current Neural Network fails to converge. An optimization algorithm can be used for one time NN hyperparameter optimization so that it can work better for systems of ODEs. We tried many approaches like biasing the cost function to prioritize earlier timepoints but this failed as well. Similar problems were found in an <a href="https://github.com/JuliaDiffEq/TensorFlowDiffEq.jl">alternative implementation using TensorFlow (TensorFlowDiffEq.jl)</a>, which suggests this may just be a problem with the solving method.</p>

<h2 id="acknowledgements">Acknowledgements</h2>

<p>I would really want to thank my GSoC mentors Chris Rackauckas and Lyndon White for the help they provided in understanding mathematical as well as coding parts of the project. Also I would like to thank the Julia community in general for giving me opportunity to contribute and for sponsoring my JuliaCon 2017 trip which was awesome.</p>


</div>



    <div class="footer">
      Julia is a <a href="https://numfocus.org/projects/index.html">NumFocus project</a>.
      We thank <a href="https://fastly.com">Fastly</a> for their generous infrastructural support.
      
      <a href="https://github.com/juliakorea/translate-home/edit/master/src/blog/_posts/2017-10-13-gsoc-NeuralNetDiffEq.md">Edit this page on GitHub.</a>
    </div>

    <!-- Add "contribute" link to the Transifex language dropdown -->
    <!--<script>
      // Create a link element for the translation prompt
      var txPromptLink = document.createElement( "a" );
      txPromptLink.href = "https://www.transifex.com/julialang-i18n/julialang-web/";
      txPromptLink.appendChild( document.createTextNode( "Add your language!" ) );
      txPromptLink.style.fontWeight = "bold";

      // Wrap the translation prompt link in a list item element
      var txPrompt = document.createElement( "li" );
      txPrompt.appendChild( txPromptLink );

      // Add the translation prompt list item to the list of languages
      document.getElementById( "tx-live-lang-picker" ).appendChild( txPrompt );
    </script>-->

<!--Flipcause Integration v3.0// Flipcause Integration Instructions:
    Install the following code block once in the website Header (after <head> tag) -->

<style>

  .fc-black_overlay{
  display:none; position: fixed; z-index:1000001; top: 0%;left: 0%;width: 100%;height: 100%;
  background-color: black; filter: alpha(opacity=50); cursor:pointer; opacity:0.5;
  }

  .fc-white_content {
  opacity:1; display:none; margin-top: -320px; margin-left: -485px; width:970px; height:640px;
  position:fixed; top:50%; left:50%; border: none;z-index:1000002;overflow: auto;
  }

  .fc-main-box{
  opacity:1; display:none; margin:15px auto 0 auto; width:930px; position:relative; z-index:1000003;
  }

  .fc-widget_close{
  opacity:1; content:url(http://i1338.photobucket.com/albums/o691/WeCause/X_zpse4a7e538.png);
  position:absolute; z-index=1000004; right:-16px; top:-16px; display:block; cursor:pointer;
  }

  .floating_button{
  display: block; margin-top: 0px; margin-left: 0px; width:auto ; height: auto;
  position:fixed; z-index:999999; overflow: auto;
  }

  @keyframes backfadesin {
  from { opacity:0; }
  to {opacity:.5;}
  }

  @-moz-keyframes backfadesin {
  from { opacity:0; }
  to {opacity:.5;}
  }

  @-webkit-keyframes backfadesin {
  from { opacity:0; }
  to {opacity:.5;}
  }

  @-o-keyframes backfadesin {
  from { opacity:0; }
  to {opacity:.5;}
  }


  @-ms-keyframes backfadesin {
  from { opacity:0; }
  to {opacity:.5;}
  }

  @keyframes fadesin {
  0%{ opacity:0; }
  50%{ opacity:0; }
  75% {opacity: 0; transform: translateY(20px);}
  100% {opacity: 1; transform: translateY(0);}
  }

  @-moz-keyframes fadesin {
  0%{ opacity:0; }
  50%{ opacity:0; }
  75% {opacity: 0; -moz-transform: translateY(20px);}
  100% {opacity: 1; -moz-transform: translateY(0);}
  }

  @-webkit-keyframes fadesin {
  0%{ opacity:0; }
  50%{ opacity:0; }
  75% {opacity: 0; -webkit-transform: translateY(20px);}
  100% {opacity: 1; -webkit-transform: translateY(0);}
  }

  @-o-keyframes fadesin {
  0%{ opacity:0; }
  50%{ opacity:0; }
  75% {opacity: 0; -o-transform: translateY(20px);}
  100% {opacity: 1; -o-transform: translateY(0);}
  }

  @-ms-keyframes fadesin {
  0%{ opacity:0; }
  50%{ opacity:0; }
  75% {opacity: 0; -ms-transform: translateY(20px);}
  100% {opacity: 1; -ms-transform: translateY(0);}
  }

</style>

<script>

  function open_window(cause_id) {
  var  protocol=String(document.location.protocol);
  var new_url;
  if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){
  new_url="https://www.flipcause.com/widget/"+cause_id
  window.open(new_url);
  }

  else {
  document.getElementById("fc-fade").style.display = "block";
  document.getElementById("fc-fade").style.webkitAnimation = "backfadesin 1s";
  document.getElementById("fc-fade").style.animation = "backfadesin 1s";
  document.getElementById("fc-fade").style.mozAnimation = "backfadesin 1s";
  document.getElementById("fc-light").style.display = "block";
  document.getElementById("fc-light").style.webkitAnimation = "fadesin 1.5s";
  document.getElementById("fc-light").style.animation = "fadesin 1.5s";
  document.getElementById("fc-light").style.mozAnimation = "fadesin 1.5s";
  document.getElementById("fc-main").style.display = "block";
  document.getElementById("fc-main").style.webkitAnimation = "fadesin 1.5s";
  document.getElementById("fc-main").style.animation = "fadesin 1.5s";
  document.getElementById("fc-main").style.mozAnimation = "fadesin 1.5s";
  document.getElementById("fc-close").style.display = "block";
  document.getElementById("fc-close").style.webkitAnimation = "fadesin 1.5s";
  document.getElementById("fc-close").style.animation = "fadesin 1.5s";
  document.getElementById("fc-close").style.mozAnimation = "fadesin 1.5s";
  document.getElementById("fc-myFrame").style.display = "block";
  document.getElementById("fc-myFrame").style.webkitAnimation = "fadesin 1.5s";
  document.getElementById("fc-myFrame").style.animation = "fadesin 1.5s";
  document.getElementById("fc-myFrame").style.mozAnimation = "fadesin 1.5s";
  document.getElementById("fc-myFrame").src="https://www.flipcause.com/widget/"+cause_id;
  }
  }


  function close_window() {
  document.getElementById("fc-fade").style.display="none";
  document.getElementById("fc-light").style.display="none";
  document.getElementById("fc-main").style.display="none";
  document.getElementById("fc-close").style.display="none";
  document.getElementById("fc-myFrame").style.display="none";
  }

</script>

<div id="fc-fade" class="fc-black_overlay" onclick="close_window()"></div>
<div id="fc-light" class="fc-white_content">
  <div id="fc-main" class="fc-main-box">
    <div id="fc-close" class="fc-widget_close" onclick="close_window()"></div>
    <iframe id="fc-myFrame" iframe height="580" width="925"
            style="border: 0; border-radius: 5px 5px 5px 5px; box-shadow: 0 0 8px rgba(0, 0, 0, 0.5);"
            scrolling="no" src=""></iframe>
  </div>
</div>

<!--END Flipcause Main Integration Code-->

    <div style="background: #ccc; border-radius: 0px 0px 0px 0px; font-weight: normal;
                font-family: Arial, Helvetica, sans-serif; border: none; box-shadow: none;
                left: 50%; margin-left: -72.5px; clear: both; display: block; width: 145px;
                height: 45px; line-height: 2.8; position: relative; font-size: 16px;
                text-align: center; cursor: pointer; color: #fff; text-decoration: none; z-index:1"
         onclick="open_window('MjI1Nw==')">
      Donate Now
    </div>
    
  </div><!-- main wrapper -->
</body>
</html>
